/* ============================================
 * Material 3 Custom Theme
 *
 * Seed: #4B6F00 | Font: Raleway
 * Palette generated via @material/material-color-utilities
 * 
 * mat.theme() emits --mat-sys-* CSS variables AND
 * all component tokens â€” icons, form fields, buttons, etc.
 * are properly themed automatically.
 * ============================================ */
@use '@angular/material' as mat;
@use 'sass:map';
@use 'variables/config' as config;
@use 'variables/palette' as palette;

/* Neutral tones extracted from palette for surface-container overrides */
$neutral: map.get(palette.$primary-palette, neutral);

/* ============================================
 * Light Theme (default)
 * ============================================ */
html {
  @include mat.theme((
    color: (
      theme-type: light,
      primary: palette.$primary-palette,
      tertiary: palette.$tertiary-palette,
    ),
    typography: (
      brand-family: config.$base-font-family,
      plain-family: config.$base-font-family,
    ),
    density: (
      scale: 0,
    ),
  ));

  /* Form Fields - sizing */
  @include mat.form-field-overrides((
    container-height: config.$component-height,
    container-vertical-padding: config.$component-vertical-padding,
  ));

  /* Buttons - all variants use same height */
  @include mat.button-overrides((
    filled-container-height: config.$component-height,
    outlined-container-height: config.$component-height,
    text-container-height: config.$component-height,
    tonal-container-height: config.$component-height,
    protected-container-height: config.$component-height,
  ));

  /* Menu panel - sizing */
  @include mat.menu-overrides((
    container-shape: 12px,
  ));

  /* ============================================
   * Surface container overrides
   *
   * mat.theme() generates surface-container tokens via
   * the CSS color() function which can resolve to transparent
   * in some rendering contexts (CDK overlays, SSR hydration).
   * Override with solid values from neutral palette tones.
   *
   * M3 light mapping (closest available neutral tones):
   *   surface-container-lowest  = neutral[100]
   *   surface-container-low     = neutral[99]
   *   surface-container         = neutral[98]
   *   surface-container-high    = neutral[95]
   *   surface-container-highest = neutral[90]
   * ============================================ */
  --mat-sys-surface-container-lowest: #{map.get($neutral, 100)};
  --mat-sys-surface-container-low: #{map.get($neutral, 99)};
  --mat-sys-surface-container: #{map.get($neutral, 98)};
  --mat-sys-surface-container-high: #{map.get($neutral, 95)};
  --mat-sys-surface-container-highest: #{map.get($neutral, 90)};
}

/* ============================================
 * Dark Theme (auto via prefers-color-scheme)
 * ============================================ */
@media (prefers-color-scheme: dark) {
  html {
    @include mat.theme((
      color: (
        theme-type: dark,
        primary: palette.$primary-palette,
        tertiary: palette.$tertiary-palette,
      ),
    ));

    /* Dark surface containers (from neutral palette tones) */
    --mat-sys-surface-container-lowest: #{map.get($neutral, 0)};
    --mat-sys-surface-container-low: #{map.get($neutral, 10)};
    --mat-sys-surface-container: #{map.get($neutral, 20)};
    --mat-sys-surface-container-high: #{map.get($neutral, 25)};
    --mat-sys-surface-container-highest: #{map.get($neutral, 30)};
  }
}
