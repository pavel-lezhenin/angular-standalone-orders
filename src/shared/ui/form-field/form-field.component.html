<mat-form-field 
  [ngClass]="fieldClass()">
  <mat-label>{{ label() }}</mat-label>
  
  @if (prefixIcon()) {
    <mat-icon matPrefix>{{ prefixIcon() }}</mat-icon>
  }
  
  @if (type() === 'textarea') {
    <textarea 
      matInput
      [formControl]="control()"
      [placeholder]="placeholder()"
      [rows]="rows()"
      [attr.maxlength]="maxLength() ?? null"
      [required]="required()"
      [attr.aria-label]="label()"
    ></textarea>
  } @else if (type() === 'select') {
    <mat-select 
      [formControl]="control()"
      [placeholder]="placeholder()"
      [required]="required()"
      [attr.aria-label]="label()"
      (selectionChange)="selectionChange.emit($event)">
      @for (option of selectOptions(); track option.value) {
        <mat-option [value]="option.value">{{ option.label }}</mat-option>
      }
    </mat-select>
  } @else {
    <input
      matInput
      [type]="type()"
      [formControl]="control()"
      [placeholder]="placeholder()"
      [attr.maxlength]="maxLength() ?? null"
      [attr.min]="min() ?? null"
      [attr.max]="max() ?? null"
      [attr.step]="step() ?? null"
      [required]="required()"
      [attr.aria-label]="label()"
    />
  }
  
  @if (suffixIcon()) {
    <mat-icon matSuffix>{{ suffixIcon() }}</mat-icon>
  }
  
  @if (hint() && !showCharacterCount()) {
    <mat-hint [align]="hintAlign()">{{ hint() }}</mat-hint>
  }
  
  @if (showCharacterCount() && maxLength()) {
    <mat-hint align="end">{{ characterCountText() }}</mat-hint>
  }
  
  @if (control() && control().invalid && control().touched) {
    <mat-error>{{ getErrorMessage() }}</mat-error>
  }
</mat-form-field>
