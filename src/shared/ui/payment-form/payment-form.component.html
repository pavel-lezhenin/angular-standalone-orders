<div class="payment-form">
  <form [formGroup]="paymentForm">
    <!-- Payment Method Selection -->
    <div class="form-section">
      <h3>Payment Method</h3>
      <mat-radio-group formControlName="method" class="payment-methods">
        @for (method of paymentMethods; track method.value) {
          <mat-radio-button [value]="method.value">
            {{ method.label }}
          </mat-radio-button>
        }
      </mat-radio-group>
    </div>

    <!-- Card Payment Fields -->
    @if (paymentForm.get('method')?.value === 'card') {
      <div class="form-section card-details">
        <h3>Card Details</h3>

        <!-- Card Number -->
        <app-form-field
          [label]="'Card Number'"
          [control]="$any(paymentForm.get('cardNumber'))"
          [type]="'text'"
          [placeholder]="'1234 5678 9012 3456'"
          [maxLength]="19"
          [prefixIcon]="'credit_card'"
          [fieldClass]="'full-width'"
          (inputChange)="formatCardNumber($event)"
          [customErrorMessages]="{
            'required': 'Card number is required',
            'invalidCard': paymentForm.get('cardNumber')?.errors?.['invalidCard']
          }"
        />

        <!-- Cardholder Name -->
        <app-form-field
          [label]="'Cardholder Name'"
          [control]="$any(paymentForm.get('cardholderName'))"
          [type]="'text'"
          [placeholder]="'JOHN DOE'"
          [prefixIcon]="'person'"
          [fieldClass]="'full-width'"
          [customErrorMessages]="{
            'required': 'Cardholder name is required',
            'minlength': 'Name must be at least 3 characters'
          }"
        />

        <!-- Expiry Date & CVV -->
        <div class="card-extra-fields">
          <div class="expiry-fields">
            <app-form-field
              [label]="'Month'"
              [control]="$any(paymentForm.get('expiryMonth'))"
              [type]="'select'"
              [fieldClass]="'expiry-month'"
              [customErrorMessages]="{'required': 'Required'}"
            >
              @for (month of months; track month.value) {
                <mat-option [value]="month.value">{{ month.label }}</mat-option>
              }
            </app-form-field>

            <app-form-field
              [label]="'Year'"
              [control]="$any(paymentForm.get('expiryYear'))"
              [type]="'select'"
              [fieldClass]="'expiry-year'"
              [customErrorMessages]="{'required': 'Required'}"
            >
              @for (year of years; track year.value) {
                <mat-option [value]="year.value">{{ year.label }}</mat-option>
              }
            </app-form-field>
          </div>

          <app-form-field
            [label]="'CVV'"
            [control]="$any(paymentForm.get('cvv'))"
            [type]="'password'"
            [placeholder]="'123'"
            [maxLength]="4"
            [prefixIcon]="'lock'"
            [fieldClass]="'cvv-field'"
            [customErrorMessages]="{
              'required': 'CVV required',
              'pattern': 'Must be 3-4 digits'
            }"
          />
        </div>

        <!-- Save Method Checkbox -->
        <div class="save-method-option">
          <mat-checkbox formControlName="shouldSaveMethod">
            <span class="save-label">Save this payment method for future orders</span>
          </mat-checkbox>
        </div>
      </div>
    }


    <!-- PayPal Message -->
    @if (paymentForm.get('method')?.value === 'paypal') {
      <div class="payment-info-message">
        <mat-icon>info</mat-icon>
        <p>You will be redirected to PayPal to complete your payment.</p>
      </div>
    }

    <!-- Cash on Delivery Message -->
    @if (paymentForm.get('method')?.value === 'cash_on_delivery') {
      <div class="payment-info-message">
        <mat-icon>info</mat-icon>
        <p>Pay with cash when your order is delivered.</p>
      </div>
    }
  </form>
</div>
